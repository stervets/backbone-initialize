!function(){var r,n,l,t,s,i="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a=i.length;this.BackbonePrepare=n=[],this.BackboneLaunchStatus={INIT:0,PREPARE:1,PREPARE_FAIL:2,READY:4},l=function(t){return Array.isArray(t)?t:t.split(",").map(function(t){return t.trim()})},s=function(t=16,e=""){for(;0<t--;)e+=i.charAt(Math.floor(Math.random()*a)),!t||t%4||(e+="-");return e},Backbone.BackboneInitializeNoWarnings=!1,r=function(){class t{warn(t){if(!Backbone.BackboneInitializeNoWarnings)return console.warn("Backbone-initialize warn: "+t)}getChild(t,e,n=this.entity){var i=t.shift();return null!=n[i]?t.length?this.getChild(t,e,n[i]):n[i]:(this.warn(i+` undefined (this.${e})`),null)}eventHandler(t){var e=this.handlers[t];return(...t)=>this.executeChain(e,t)}executeChain(e,n,i=this.entity,a,t){var r,s;return n=n||[],null==a&&(a=$.Deferred(),e=e.slice(),(r=a.promise()).defer=a),s=e.shift(),$.when(s.apply(i,n.concat(t||[]))).done((...t)=>e.length?this.executeChain(e,n,i,a,t):a.resolve.apply(i,n.concat(t||[]))).fail(function(...t){return Backbone.BackboneInitializeNoWarnings||console.warn("Deferred chain fail",s),a.reject.apply(i,n.concat(t||[]))}),r}addListener(t,e,n,i){var a;return null==t._bbId&&(t._bbId=s()),a=t._bbId+"-"+e,null==this.handlers[a]&&(this.handlers[a]=[],this.entity.listenTo(t,e,this.eventHandler(a))),this.handlers[a].push(n.bind(i))}addHandler(t,s,h=this.entity){var a,e,n;if("object"==typeof t){for(a in e=[],t)n=t[a],e.push(this.addHandler(a,n,h));return e}if("object"!=typeof s||Array.isArray(s))return"string"==typeof s&&(s=l(s)),s=(s=Array.isArray(s)?s:[s]).slice(),"_"===t[0]&&(t=s.shift()),l(t).forEach(a=>{var r=h,t=a.split(".");if(a=t.pop(),!t.length||(r=this.getChild(t,t.join("."),r)))return s.forEach(t=>{var e,n=!1,i=this.entity;if("string"==typeof t){if(t=(e=(n=t).split(".")).pop(),!(i=e.length?this.getChild(e,n):this.entity))return;t=i[t]}return"function"==typeof t?this.addListener(r,a,t,i):this.warn(`Can't find handler for "${a}"`+(n?`: "${n}"`:""))})});l(t).forEach(t=>{var e,n,i;if(e=this.getChild(t.split("."),t,h)){for(a in n=[],s)i=s[a],n.push(this.addHandler(a,i,e));return n}return this.warn(`Can't append handlers to ${t} cause child not found`)})}addHandlers(){if(null!=this.entity.handlers&&!this.entity.disableHandlers)return this.addHandler(this.entity.handlers)}launch(t,...e){return null!=t&&this.addHandlers(),this.entity.launchStatus=BackboneLaunchStatus.READY,this.entity.trigger("launch",...e)}prepareAndLaunch(t){var e;return this.entity.firstLaunch=null!=this.prepares,(n.length||Array.isArray(this.entity.prepare))&&(null==this.prepares&&((e=this.entity).prepare||(e.prepare=[]),this.entity.prepare=n.concat(this.entity.prepare),this.prepares=this.entity.prepare.map(t=>{var e="function"==typeof t?t:this.entity[t];return"function"!=typeof e&&(this.warn(`Prepare item ${t} isn't function`),e=$.noop),e})),this.prepares.length)?(this.entity.launchStatus=BackboneLaunchStatus.PREPARE,this.entity.promise=this.executeChain(this.prepares,t),this.entity.promise.done(()=>this.launch(this.entity.firstLaunch,...t)).fail(()=>{if(Backbone.BackboneInitializeNoWarnings||console.warn("Backbone initialize prepares fail: ",this.prepares),this.entity.launchStatus=BackboneLaunchStatus.PREPARE_FAIL,"function"==typeof this.entity.onLaunchFail)return this.entity.onLaunchFail(...t)}),this.entity.promise):this.launch(this.entity.firstLaunch,...t)}constructor(t){var e,n,i;if(this.entity=t,null==this.entity.noBind)for(n in i=this.entity)"function"==typeof(e=i[n])&&(this.entity[n]=e.bind(this.entity));this.entity.addHandler=this.addHandler.bind(this),this.entity.executeChain=this.executeChain.bind(this),this.handlers={},this.entity.launchStatus=BackboneLaunchStatus.INIT}}return t.prototype.handlers=null,t.prototype.entity=null,t.prototype.prepares=null,t}.call(this),t=function(...t){var e,n,i,a=this.options;if(null==a&&(a=t[1]),"string"==typeof this.prepare&&(this.prepare=l(this.prepare)),"object"==typeof this.handlers||null!=(null!=a?a.attach:void 0)||"function"==typeof this.launch||Array.isArray(this.prepare)){if(this._bbInitialize=new r(this),"function"==typeof this.launch&&this.addHandler("launch",this.launch),null!=(null!=a?a.attach:void 0))for(e in i=a.attach)n=i[e],this[e]=n;return this.relaunch=()=>this._bbInitialize.prepareAndLaunch(t),this.relaunch()}},Backbone.Model.prototype.initialize=t,Backbone.Collection.prototype.initialize=t,Backbone.View.prototype.initialize=t,null!=Backbone.NestedModel&&(Backbone.NestedModel.prototype.initialize=t),null!=Backbone.Layout&&(Backbone.Layout.prototype.initialize=t),"undefined"!=typeof Marionette&&null!==Marionette&&(Marionette.Object.prototype.initialize=t)}.call(this);