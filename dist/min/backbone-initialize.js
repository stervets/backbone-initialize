!function(){var r,e,l,t,s,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",a=n.length;this.BackbonePrepare=e=[],this.BackboneLaunchStatus={INIT:0,PREPARE:1,PREPARE_FAIL:2,READY:4},l=function(t){return Array.isArray(t)?t:t.split(",").map(function(t){return t.trim()})},s=function(t=16,i=""){for(;0<t--;)i+=n.charAt(Math.floor(Math.random()*a)),!t||t%4||(i+="-");return i},Backbone.BackboneInitializeNoWarnings=!1,r=function(){class t{warn(t){if(!Backbone.BackboneInitializeNoWarnings)return console.warn("Backbone-initialize warn: "+t)}getChild(t,i,e=this.entity){var n=t.shift();return null!=e[n]?t.length?this.getChild(t,i,e[n]):e[n]:(this.warn(n+` undefined (this.${i})`),null)}eventHandler(t){var i=this.handlers[t];return(...t)=>this.executeChain(i,t)}executeChain(t,i,e=this.entity,n,a){var r,s;return i=i||[],null==n&&(n=$.Deferred(),t=t.slice(),(r=n.promise()).defer=n),s=t.shift(),$.when(s.apply(e,i.concat(a||[]))).done(()=>{},t.length?this.executeChain(t,i,e,n,a):n.resolve.apply(e,i.concat(a||[]))).fail(function(){},Backbone.BackboneInitializeNoWarnings?void 0:console.warn("Deferred chain fail",s),n.reject.apply(e,i.concat(a||[]))),r}addListener(t,i,e,n){var a;return null==t._bbId&&(t._bbId=s()),a=t._bbId+"-"+i,null==this.handlers[a]&&(this.handlers[a]=[],this.entity.listenTo(t,i,this.eventHandler(a))),this.handlers[a].push(e.bind(n))}addHandler(t,s,h=this.entity){var a,i,e;if("object"==typeof t){for(a in i=[],t)e=t[a],i.push(this.addHandler(a,e,h));return i}if("object"!=typeof s||Array.isArray(s))return"string"==typeof s&&(s=l(s)),s=(s=Array.isArray(s)?s:[s]).slice(),"_"===t[0]&&(t=s.shift()),l(t).forEach(a=>{var r=h,t=a.split(".");if(a=t.pop(),!t.length||(r=this.getChild(t,t.join("."),r)))return s.forEach(t=>{var i,e=!1,n=this.entity;if("string"==typeof t){if(t=(i=(e=t).split(".")).pop(),!(n=i.length?this.getChild(i,e):this.entity))return;t=n[t]}return"function"==typeof t?this.addListener(r,a,t,n):this.warn(`Can't find handler for "${a}"`+(e?`: "${e}"`:""))})});l(t).forEach(t=>{var i,e,n;if(i=this.getChild(t.split("."),t,h)){for(a in e=[],s)n=s[a],e.push(this.addHandler(a,n,i));return e}return this.warn(`Can't append handlers to ${t} cause child not found`)})}addHandlers(){if(null!=this.entity.handlers&&!this.entity.disableHandlers)return this.addHandler(this.entity.handlers)}launch(t,...i){return null!=t&&this.addHandlers(),this.entity.launchStatus=BackboneLaunchStatus.READY,this.entity.trigger("launch",...i)}prepareAndLaunch(t){var i;return this.entity.firstLaunch=null!=this.prepares,(e.length||Array.isArray(this.entity.prepare))&&(null==this.prepares&&((i=this.entity).prepare||(i.prepare=[]),this.entity.prepare=e.concat(this.entity.prepare),this.prepares=this.entity.prepare.map(t=>{var i="function"==typeof t?t:this.entity[t];return"function"!=typeof i&&(this.warn(`Prepare item ${t} isn't function`),i=$.noop),i})),this.prepares.length)?(this.entity.launchStatus=BackboneLaunchStatus.PREPARE,this.entity.promise=this.executeChain(this.prepares,t),this.entity.promise.done(()=>{},this.launch(this.entity.firstLaunch,...t)).fail(()=>{},Backbone.BackboneInitializeNoWarnings?void 0:console.warn("Backbone initialize prepares fail: ",this.prepares),this.entity.launchStatus=BackboneLaunchStatus.PREPARE_FAIL,"function"==typeof this.entity.onLaunchFail?this.entity.onLaunchFail(...t):void 0),this.entity.promise):this.launch(this.entity.firstLaunch,...t)}constructor(t){var i,e,n;if(this.entity=t,null==this.entity.noBind)for(e in n=this.entity)"function"==typeof(i=n[e])&&(this.entity[e]=i.bind(this.entity));this.entity.addHandler=this.addHandler.bind(this),this.entity.executeChain=this.executeChain.bind(this),this.handlers={},this.entity.launchStatus=BackboneLaunchStatus.INIT}}return t.prototype.handlers=null,t.prototype.entity=null,t.prototype.prepares=null,t}.call(this),t=function(...t){var i,e,n,a=this.options;if(null==a&&(a=t[1]),"string"==typeof this.prepare&&(this.prepare=l(this.prepare)),"object"==typeof this.handlers||null!=(null!=a?a.attach:void 0)||"function"==typeof this.launch||Array.isArray(this.prepare)){if(this._bbInitialize=new r(this),"function"==typeof this.launch&&this.addHandler("launch",this.launch),null!=(null!=a?a.attach:void 0))for(i in n=a.attach)e=n[i],this[i]=e;return this.relaunch=()=>this._bbInitialize.prepareAndLaunch(t),this.relaunch()}},Backbone.Model.prototype.initialize=t,Backbone.Collection.prototype.initialize=t,Backbone.View.prototype.initialize=t,null!=Backbone.NestedModel&&(Backbone.NestedModel.prototype.initialize=t),null!=Backbone.Layout&&(Backbone.Layout.prototype.initialize=t),"undefined"!=typeof Marionette&&null!==Marionette&&(Marionette.Object.prototype.initialize=t)}.call(this);